# ui-spec.md（UI要件仕様 / LLM GM ソロTRPG）

## 0. 目的と範囲
本書はUI/UX要件を定義する。ゲームルールは `game-spec.md` / `mechanics-spec.md`、機能仕様は `functional-spec.md` を参照する。  
本アプリは **プレイヤーとLLMのチャット**を主導線とし、1セッション約1時間で完結する体験を阻害しないUIを目標とする。

---

## 1. 画面一覧
- **Start（開始）**
- **Character（キャラ作成）**
- **Play（プレイ/チャット）**
- **Result（リザルト）**

---

## 2. 共通UI要件
### 2.1 表記・トーン
- GMの発話とシステム情報（判定結果など）を視覚的に区別する
- 長文は折りたたみ/段落分けで読みやすくする
- 重要情報（現在の目的、次の行動）を埋もれさせない

### 2.2 レスポンシブ
- PCのWebブラウザでのプレイを想定
- Play画面は **縦スクロール**を前提
- ステータス/ログなどは、スマホでは折りたたみ（タブ/アコーディオン）を基本とする

### 2.3 入力補助
- 送信はボタン＋Enter（Shift+Enterで改行）
- 送信中（LLM応答待ち）は入力欄をロックし、キャンセル（任意）を表示してよい
- 選択肢ボタンを押した場合は、入力欄に文言を差し込むか即送信（実装方針でどちらかに統一）

---

## 3. 画面別要件

## 3.1 Start（開始）
### 目的
- 新規セッション開始の導線を提供する
- 初期シナリオ生成に使う「テーマ・雰囲気」をユーザーが自然言語で指定できるようにする

### UI要素
- タイトル/簡単な説明
- 「はじめる」ボタン
- テーマ・雰囲気（自然言語）入力欄（任意）
  - プレースホルダ例：
    - 「静かな田舎のミステリー。怖すぎない」
    - 「90年代日本のホラー、じめっとした感じ」
    - 「軽い冒険、コミカル、後味よく」
  - 文字数目安：0〜200文字（超過は警告 or 自動短縮）
- （任意）プリセット（チップ/ボタン）
  - 例：ホラー / ミステリー / 冒険、重い / 軽い、現代日本 / 異世界 など
  - 押すと入力欄に追記（または置換）

### 動作
- 「はじめる」で Character へ遷移
- 入力されたテーマ・雰囲気はセッション状態に保持し、初期シナリオ生成時にLLMへ渡す
- すでにセッション中の状態が存在する場合は、保存/再開がないため「新規開始」扱い（警告を出してよい）

---

## 3.2 Character（キャラ作成）
### 目的
- PCを短時間で作り、プレイ開始できる状態にする

### UI要素（必須）
- プロフィール入力
  - 名前（必須）
  - 職業（任意または選択式）
  - 年齢/性別/特徴（任意）
- 能力値生成
  - 「能力値を振る」ボタン（ダイス結果を表示）
  -  振り直し回数の制限はなし
- 派生値の自動表示（SAN/HP/MPなど）
- 技能割り振り
  - 職業技能ポイント、趣味技能ポイントの残量表示
  - 技能一覧（初期値表示、加算入力、合計表示）
- 「確定して開始」ボタン

### UI要素（任意）
- 職業テンプレの提案（LLMが提案した職業セットを選べる等）
- 「ルールを見る」（判定の簡易説明）

### バリデーション
- 名前未入力では開始不可
- 技能ポイントが未使用/過剰の場合は警告（強制はしない or 強制する、どちらかに統一）
- 能力値生成が未実施の場合は開始不可

---

## 3.3 Play（プレイ/チャット）
### 目的
- チャットでゲームを進行し、必要な情報を見失わない

### レイアウト（推奨）
- メイン：チャットログ（タイムライン）
- 下部固定：入力欄＋送信
- サブ：右ペイン（PC）/タブ（スマホ）で「状態」を表示

### 3.3.1 チャット表示
- メッセージ種別
  - GM（LLM）発話
  - プレイヤー発話
  - システム（判定結果、状態更新のサマリ）
- GMの長文は段落分割、必要なら折りたたみ
- 重要情報（objective、判定要求）は強調表示

### 3.3.2 状態パネル（必須）
- **目的（objective）**：常に見える場所に1行表示
- **主要リソース**：SAN/HP/MP/TIME等（採用しているもの）
- **所持品**：一覧（最大枠まで）
- **重要フラグ**：短いラベルのリスト（過剰表示しない）

### 3.3.3 選択肢UI（任意だが推奨）
- GMが `choices` を返した場合、チャット下部またはメッセージ直下にボタン表示（2〜4個）
- 押すと「その内容で行動する」発話として送信される（文言は編集可能でもよい）

### 3.3.4 判定UI（必須）
判定要求（`check_request`）が来た場合、判定用UIを表示する。

- 表示内容
  - 使用技能
  - 難易度（補正）
  - 目標値（自動計算）
- 操作
  - 「ロールする」ボタンで d100 を振る
  - 出目、成功段階を表示
  - 結果は自動でLLMへ送信（または「結果を送る」ボタンで送信、どちらかに統一）
- ロールのログ
  - チャットに「判定結果（出目/目標値/成功段階）」をシステムメッセージとして残す

### 3.3.5 状態更新の可視化（推奨）
- LLMの `state_patch` が反映された場合、チャットに「更新サマリ」を表示
  - 例：HP -1、TIME -1、フラグ追加、所持品消費
- 反映理由はGM文側に含める（UIでは短く表示）

### 3.3.6 進行補助（任意）
- 「次に何をすればいい？」ボタン（objectiveを再提示させる）
- 「状況整理」ボタン（summary更新を促す）

### 3.3.7 中断・リセット
- 保存/再開はないため、明示的に「セッションを終了」/「最初から」を用意してよい
- 誤操作防止の確認ダイアログを出す

---

## 3.4 Result（リザルト）
### 目的
- 結末と要約を提示して満足感を出す

### UI要素
- 結末種別（成功/失敗/時間切れ）
- 重要な出来事の要約
- 獲得物/失ったもの
- 最終状態（主要リソース/重要フラグ）
- 「もう一度遊ぶ」（Startへ）
- （任意）ログのコピー/ダウンロード

---

## 4. ローディング・エラー表示
### 4.1 ローディング
- LLM応答待ちを表示（スピナー＋短いテキスト）
- ストリーミング表示は任意（実装負荷に合わせる）

### 4.2 エラー
- LLM応答不正/失敗時は、ユーザーに短い説明を表示
- リトライが可能な場合は「もう一度」ボタン
- 続行不能の場合は Result（失敗扱いでもよい）へ誘導

---

## 5. アクセシビリティ（最低限）
- ボタンはタップしやすいサイズ
- 重要テキストはコントラストを確保（実装側で配慮）
- キーボード操作（Enter送信など）